<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Add Comments</title>

  
  <meta name="author" content="Christopher Himes">
  

  <meta name="description" content="My blog has Mastodon powered comments now and this post is really just a test for that.



This is almost completely the Cassidy James implementation of comments via Mastodon. Although I do have plans to do some more specific styling for this site it works well as is. Don’t have much more to say about it other than thanks to Mr. James and if you’re interested in adding Mastodon comments to your site I’ve linked to Cassidy’s post about it.

I may go back and add comments to previous posts but for now this post will be the only one with comments. The implementation requires an API call with reference to an existing post on Mastodon and I’m not sure if I want to be posting about previous entries in this blog.

The image above is from Photo by Jason Leung on Unsplash.">

  

  

  
  <link rel="alternate" type="application/rss+xml" title="christopher himes" href="http://localhost:4000/feed.xml">
  

  

  

  

  
  
  

  
  <meta property="og:site_name" content="christopher himes">
  <meta property="og:title" content="Add Comments">
  <meta property="og:description" content="My blog has Mastodon powered comments now and this post is really just a test for that.



This is almost completely the Cassidy James implementation of comments via Mastodon. Although I do have plans to do some more specific styling for this site it works well as is. Don’t have much more to say about it other than thanks to Mr. James and if you’re interested in adding Mastodon comments to your site I’ve linked to Cassidy’s post about it.

I may go back and add comments to previous posts but for now this post will be the only one with comments. The implementation requires an API call with reference to an existing post on Mastodon and I’m not sure if I want to be posting about previous entries in this blog.

The image above is from Photo by Jason Leung on Unsplash.">

  
  <meta property="og:image" content="http://localhost:4000/assets/img/blog/add-comments/comments.webp">
  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Christopher Himes">
  <meta property="og:article:published_time" content="2024-01-13T13:00:00-05:00">
  <meta property="og:url" content="http://localhost:4000/blog/2024/01/13/add-comments.html">
  <link rel="canonical" href="http://localhost:4000/blog/2024/01/13/add-comments.html">
  
  <style type="text/css">
    
    @font-face {
  font-family: "comprehensionsemibold";
  src: url("../../../../../assets/css/comprehension-semibold-webfont.woff2") format("woff2"), url("../../../../../assets/css/comprehension-semibold-webfont.woff") format("woff");
  font-weight: normal;
  font-style: normal;
}
body {
  background-color: rgb(26, 26, 26);
  color: rgb(200, 200, 200);
  margin-top: 0px;
  font-family: Georgia, "Times New Roman", Times, serif;
  letter-spacing: 0.15em;
}

h1, h2, h3, h4, h5 {
  font-family: "comprehensionsemibold", Arial, Helvetica, sans-serif;
  letter-spacing: 0.25em;
}

span {
  margin: 0;
  padding: none;
}

h1 {
  color: rgb(32, 255, 188);
  margin-bottom: 1em;
}

h2 {
  color: rgb(25, 209, 255);
  margin: 0;
}

h3 {
  color: rgb(211, 211, 211);
  margin: 2em 0;
}

hr {
  border: dashed 2px rgb(211, 211, 211);
}

p {
  color: rgb(200, 200, 200);
}

a:hover {
  text-decoration: underline;
}

a {
  text-decoration: none;
}

.post-link {
  font-size: 2em;
}

.wrapper {
  margin: 0 auto;
}

.site-nav {
  margin-top: 0;
  float: right;
}

.page-link {
  margin: 0 1em;
}

a, a:visited, a:hover .page-link {
  color: rgb(25, 209, 255);
}

.face {
  clip-path: circle(150px at center);
  filter: invert(0%) sepia(0%) saturate(2%) hue-rotate(186deg) brightness(97%) contrast(101%);
}

.site-title {
  font-family: "comprehensionsemibold", Arial, Helvetica, sans-serif;
  font-size: 1.2em;
  background: -webkit-gradient(linear, left top, right bottom, from(rgb(32, 255, 188)), to(#1086a3));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-decoration: none;
}

.fa-gradient {
  background: -webkit-gradient(linear, left top, right bottom, from(rgb(32, 255, 188)), to(#1086a3));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  display: initial; /* reset Font Awesome's display:inline-block */
  font-display: swap;
}

.site-header {
  border-image: linear-gradient(34deg, rgb(32, 255, 188), #1086a3) 1;
  border-width: 5px;
  border-style: solid;
  border-left: 0;
  border-right: 0;
  border-bottom: 0;
  margin: 0px -5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  padding-left: 30px;
  padding-right: 30px;
}

.home-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 3em;
  margin: 2em auto;
  flex-direction: row;
  width: 80%;
  flex: 2 100%;
}

.home-name {
  font-family: "comprehensionsemibold", Arial, Helvetica, sans-serif;
  background: -webkit-gradient(linear, left top, right bottom, from(rgb(32, 255, 188)), to(#1086a3));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  font-size: 2.5em;
}

.home-heading {
  font-size: 2em;
  color: rgb(32, 255, 188);
}

.site-nav {
  display: flex;
  padding: 10px 15px;
}

.article {
  border-width: 2px;
  border-style: solid;
  padding: 1em;
  border: 2px solid transparent;
  border-radius: 20px;
  background-origin: border-box;
  background-clip: padding-box, border-box;
  display: flex;
  flex-flow: column;
  justify-content: left;
}

.wrapper {
  margin: auto;
  width: 1200px;
  display: flex;
  justify-content: left;
  align-items: left;
  gap: 3em;
  flex-direction: column;
  line-height: 2.5em;
  flex: 1 100%;
}

.post-detail, .page-detail {
  align-items: left;
  text-align: left;
  font-size: 1.25em;
}

.dt-published {
  color: rgb(25, 209, 255);
}

.blog-entry {
  width: 100%;
  padding: 1em 0;
  align-items: left;
  text-align: left;
  border-top: dashed 2px rgb(211, 211, 211);
}

.footer-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1.5em;
}

@media (max-width: 1200px) {
  .wrapper {
    width: 100%;
  }
  .home-wrapper {
    width: 90%;
  }
}
@media (max-width: 800px) {
  .home-wrapper {
    flex-direction: column;
  }
  .home-wrapper {
    width: 90%;
  }
}
  </style>
  <link rel="stylesheet" href="/assets/css/style.css">

  <link
    rel="preload"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
/>
<noscript>
    <link
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        rel="stylesheet"
        type="text/css"
    />
</noscript>
  
  <link href="/favicon.ico" rel="icon" type="image/x-icon">
  

  
</head>
<body><header>
  <nav class="site-header"><div class="site-title"><a rel="author" href="/">christopher himes</a></div><nav class="site-nav"><a class="page-link" href="/about/">about</a><a class="page-link" href="/blog/">blog</a></nav></nav>
</header>
<main class="wrapper" aria-label="Content">
        

<div class="" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="post-detail">
  <header>
    <h1 class="post-title" itemprop="name headline">Add Comments</h1>
    <p><time class="dt-published" datetime="2024-01-13T13:00:00-05:00" itemprop="datePublished">
        Jan 13, 2024
      </time></p>
  </header>
    <article itemprop="articleBody">
      <p><img src="../../../../assets/img/blog/add-comments/comments.webp" alt="main-image" title="Comments" /></p>

<p>My blog has <a href="https://joinmastodon.org/">Mastodon</a> powered comments now and this post is really just a test for that.</p>

<!--more-->

<p>This is almost completely the <a href="https://cassidyjames.com/blog/fediverse-blog-comments-mastodon/">Cassidy James</a> implementation of comments via Mastodon. Although I do have plans to do some more specific styling for this site it works well as is. Don’t have much more to say about it other than thanks to Mr. James and if you’re interested in adding Mastodon comments to your site I’ve linked to Cassidy’s post about it.</p>

<p>I may go back and add comments to previous posts but for now this post will be the only one with comments. The implementation requires an API call with reference to an existing post on Mastodon and I’m not sure if I want to be posting about previous entries in this blog.</p>

<p><em>The image above is from <a href="https://unsplash.com/@ninjason">Photo by Jason Leung on Unsplash</a>.</em></p>


    </article>
  <a href="/blog/2024/01/13/add-comments.html" hidden></a>
</div>

<hr />

<div class="post-detail"><!--
Inspired by https://codeberg.org/jwildeboer/jwildeboersource/src/commit/45f9750bb53b9f0f6f28399ce4d21785a3bb7d22/_includes/fediverse_comments.html
-->

<section id="comments" class="comments">
  <h2>Comments</h2>
  <p>Comment on this blog post by publicly replying to <a href="https://hachyderm.io/@eeentropyyy/111751363096054709">this Mastodon post</a> using a Mastodon or other ActivityPub/&ZeroWidthSpace;Fediverse account. Known non-private replies are displayed below.</p>

  <div id="comments-wrapper">
    <p><small>No known comments, yet. Reply to <a href="https://hachyderm.io/@eeentropyyy/111751363096054709">this Mastodon post</a> to add your own!</small></p>
    <noscript><p>Loading comments relies on JavaScript. Try enabling JavaScript and reloading, or visit <a href="https://hachyderm.io/@eeentropyyy/111751363096054709">the original post</a> on Mastodon.</p></noscript>
  </div>

  <script src="/assets/js/purify.min.js"></script>
  <script>
    loadComments ();

    function loadComments() {
      let commentsWrapper = document.getElementById("comments-wrapper");
      let postUrl = "https://hachyderm.io/api/v1/statuses/111751363096054709";

      fetch(postUrl)
      .then(function(response) {
        return response.json();
      })
      .then(function(op) {
        fetch(postUrl + "/context")
        .then(function(response) {
          return response.json();
        })
        .then(function(data) {
          let descendants = data['descendants'];
          if(
            descendants &&
            Array.isArray(descendants) &&
            descendants.length > 0
          ) {
            commentsWrapper.innerHTML = "";
            descendants.unshift(op);

            data['descendants'].forEach(function(status) {
              if( status.account.display_name.length > 0 ) {
                status.account.display_name = escapeHtml(status.account.display_name);
                status.account.display_name = emojify(status.account.display_name, status.account.emojis);
              } else {
                status.account.display_name = status.account.username;
              };

              let instance = "";
              let verified = false;
              if( status.account.acct.includes("@") ) {
                instance = status.account.acct.split("@")[1];
              } else {
                instance = "hachyderm.io";
                verified = true;
              }

              status.content = emojify(status.content, status.emojis);

              let avatarSource = document.createElement("source");
              avatarSource.setAttribute("srcset", escapeHtml(status.account.avatar));
              avatarSource.setAttribute("media", "(prefers-reduced-motion: no-preference)");

              let avatarImg = document.createElement("img");
              avatarImg.className = "avatar";
              avatarImg.setAttribute("src", escapeHtml(status.account.avatar_static));
              avatarImg.setAttribute("alt", `Avatar for ${ status.account.display_name }`);

              let avatarPicture = document.createElement("picture");
              avatarPicture.appendChild(avatarSource);
              avatarPicture.appendChild(avatarImg);

              let avatarLink = document.createElement("a");
              avatarLink.className = "avatar-link";
              avatarLink.setAttribute("href", status.account.url);
              avatarLink.setAttribute("rel", "external nofollow");
              avatarLink.setAttribute("title", `View profile at @${ status.account.username }@${ instance }`);
              avatarLink.appendChild(avatarPicture);

              let instanceBadge = document.createElement("a");
              instanceBadge.className = "instance";
              instanceBadge.setAttribute("href", status.account.url);
              instanceBadge.setAttribute("title", `@${ status.account.username }@${ instance }`);
              instanceBadge.setAttribute("rel", "external nofollow");
              instanceBadge.textContent = instance;

              let display = document.createElement("span");
              display.className = "display";
              display.setAttribute("itemprop", "author");
              display.setAttribute("itemtype", "http://schema.org/Person");
              display.innerHTML = status.account.display_name;

              let header = document.createElement("header");
              header.className = "author";
              header.appendChild(display);
              header.appendChild(instanceBadge);

              let permalink = document.createElement("a");
              permalink.setAttribute("href", status.url);
              permalink.setAttribute("itemprop", "url");
              permalink.setAttribute("title", `View comment at ${ instance }`);
              permalink.setAttribute("rel", "external nofollow");
              permalink.textContent = new Date( status.created_at ).toLocaleString('en-US', {
                dateStyle: "long",
                timeStyle: "short",
              });

              let timestamp = document.createElement("time");
              timestamp.setAttribute("datetime", status.created_at);
              timestamp.appendChild(permalink);

              let main = document.createElement("main");
              main.setAttribute("itemprop", "text");
              main.innerHTML = status.content;

              let interactions = document.createElement("footer");
              if(status.favourites_count > 0) {
                let faves = document.createElement("a");
                faves.className = "faves";
                /* FIXME: This is a hack and probably won't work w/non-Mastodon instances */
                faves.setAttribute("href", `${ status.url }/favourites`);
                faves.setAttribute("title", `Favorites from ${ instance }`);
                faves.textContent = status.favourites_count;

                interactions.appendChild(faves);
              }

              let comment = document.createElement("article");
              comment.id = `comment-${ status.id }`;
              comment.className = "comment";
              comment.setAttribute("itemprop", "comment");
              comment.setAttribute("itemtype", "http://schema.org/Comment");
              comment.appendChild(avatarLink);
              comment.appendChild(header);
              comment.appendChild(timestamp);
              comment.appendChild(main);
              comment.appendChild(interactions);

              if(verified === true) {
                comment.classList.add("verified");
              }

              commentsWrapper.innerHTML += DOMPurify.sanitize(comment.outerHTML);
            });
          }
        });
      });
    }

    function emojify(input, emojis) {
      let output = input;

      emojis.forEach(emoji => {
        let picture = document.createElement("picture");

        let source = document.createElement("source");
        source.setAttribute("srcset", escapeHtml(emoji.url));
        source.setAttribute("media", "(prefers-reduced-motion: no-preference)");

        let img = document.createElement("img");
        img.className = "emoji";
        img.setAttribute("src", escapeHtml(emoji.static_url));
        img.setAttribute("alt", `:${ emoji.shortcode }:`);
        img.setAttribute("title", `:${ emoji.shortcode }:`);
        img.setAttribute("width", "20");
        img.setAttribute("height", "20");

        picture.appendChild(source);
        picture.appendChild(img);

        output = output.replace(`:${ emoji.shortcode }:`, picture.outerHTML);
      });

      return output;
    }

    function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/'/g, "&apos;")
        .replace(/"/g, "&quot;")
      ;
    }
  </script>
</section><hr /></div>
</div>




    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-wrapper">
      <div class="footer-col">
             <a href="/feed.xml" title="RSS">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fas fa-circle fa-stack-2x fa-gradient"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">RSS</span>
            </a>
            <a href="mailto:christopher@christopherhimes.com" title="Email me">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fas fa-circle fa-stack-2x fa-gradient"></i>
                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">Email me</span>
           </a>
            <a href="https://github.com/christopherhimes" title="GitHub">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fas fa-circle fa-stack-2x fa-gradient"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">GitHub</span>
           </a>
            <a rel="me" href="https://hachyderm.io/@eeentropyyy">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fas fa-circle fa-stack-2x fa-gradient"></i>
                <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">Mastodon</span>
            </a>
      </div>
      <div class="footer-col">
        <p>Christopher Himes is a Product Owner living in Metro Detroit.
</p>
      </div>
    </div>


  </div>

</footer>
</body>

</html>
