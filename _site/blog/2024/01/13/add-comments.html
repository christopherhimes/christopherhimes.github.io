<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Add Comments</title>

  
  <meta name="author" content="Christopher Himes">
  

  <meta name="description" content="My blog has Mastodon powered comments now and this post is really just a test for that.



This is almost completely the Cassidy James implementation of comments via Mastodon. Although I do have plans to do some more specific styling for this site it works well as is. Don’t have much more to say about it other than thanks to Mr. James and if you’re interested in adding Mastodon comments to your site I’ve linked to Cassidy’s post about it.

I may go back and add comments to previous posts but for now this post will be the only one with comments. The implementation requires an API call with reference to an existing post on Mastodon and I’m not sure if I want to be posting about previous entries in this blog.

The image above is from Photo by Jason Leung on Unsplash.">

  

  

  
  <link rel="alternate" type="application/rss+xml" title="Christopher Himes" href="http://localhost:4000/feed.xml">
  

  

  

  

  
  
  

  
  <meta property="og:site_name" content="Christopher Himes">
  <meta property="og:title" content="Add Comments">
  <meta property="og:description" content="My blog has Mastodon powered comments now and this post is really just a test for that.



This is almost completely the Cassidy James implementation of comments via Mastodon. Although I do have plans to do some more specific styling for this site it works well as is. Don’t have much more to say about it other than thanks to Mr. James and if you’re interested in adding Mastodon comments to your site I’ve linked to Cassidy’s post about it.

I may go back and add comments to previous posts but for now this post will be the only one with comments. The implementation requires an API call with reference to an existing post on Mastodon and I’m not sure if I want to be posting about previous entries in this blog.

The image above is from Photo by Jason Leung on Unsplash.">

  
  <meta property="og:image" content="http://localhost:4000/images/blog/comments.jpg">
  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Christopher Himes">
  <meta property="og:article:published_time" content="2024-01-13T13:00:00-05:00">
  <meta property="og:url" content="http://localhost:4000/blog/2024/01/13/add-comments.html">
  <link rel="canonical" href="http://localhost:4000/blog/2024/01/13/add-comments.html">
  
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">
  <link href="/favicon.ico" rel="icon" type="image/x-icon">
  

  
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Christopher Himes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <defs>
                <linearGradient id="gradient">
                  <stop offset="0%" stop-color="#128562" />
                  <stop offset="100%" stop-color="#1086a3" />
                </linearGradient>
              </defs>
              <path fill="url(#gradient)" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/blog/">Blog</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Add Comments</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-01-13T13:00:00-05:00" itemprop="datePublished">
        Jan 13, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><img src="/images/blog/comments.jpg" alt="main-image" title="Comments" /></p>

<p>My blog has <a href="https://joinmastodon.org/">Mastodon</a> powered comments now and this post is really just a test for that.</p>

<!--more-->

<p>This is almost completely the <a href="https://cassidyjames.com/blog/fediverse-blog-comments-mastodon/">Cassidy James</a> implementation of comments via Mastodon. Although I do have plans to do some more specific styling for this site it works well as is. Don’t have much more to say about it other than thanks to Mr. James and if you’re interested in adding Mastodon comments to your site I’ve linked to Cassidy’s post about it.</p>

<p>I may go back and add comments to previous posts but for now this post will be the only one with comments. The implementation requires an API call with reference to an existing post on Mastodon and I’m not sure if I want to be posting about previous entries in this blog.</p>

<p><em>The image above is from <a href="https://unsplash.com/@ninjason">Photo by Jason Leung on Unsplash</a>.</em></p>


  </div>

  <a class="u-url" href="/blog/2024/01/13/add-comments.html" hidden></a>
</article>

<hr /><!--
Inspired by https://codeberg.org/jwildeboer/jwildeboersource/src/commit/45f9750bb53b9f0f6f28399ce4d21785a3bb7d22/_includes/fediverse_comments.html
-->

<section id="comments" class="comments">
  <h2>Comments</h2>
  <p>Comment on this blog post by publicly replying to <a href="https://hachyderm.io/@eeentropyyy/111751363096054709">this Mastodon post</a> using a Mastodon or other ActivityPub/&ZeroWidthSpace;Fediverse account. Known non-private replies are displayed below.</p>

  <div id="comments-wrapper">
    <p><small>No known comments, yet. Reply to <a href="https://hachyderm.io/@eeentropyyy/111751363096054709">this Mastodon post</a> to add your own!</small></p>
    <noscript><p>Loading comments relies on JavaScript. Try enabling JavaScript and reloading, or visit <a href="https://hachyderm.io/@eeentropyyy/111751363096054709">the original post</a> on Mastodon.</p></noscript>
  </div>

  <script src="/js/purify.min.js"></script>
  <script>
    loadComments ();

    function loadComments() {
      let commentsWrapper = document.getElementById("comments-wrapper");
      let postUrl = "https://hachyderm.io/api/v1/statuses/111751363096054709";

      fetch(postUrl)
      .then(function(response) {
        return response.json();
      })
      .then(function(op) {
        fetch(postUrl + "/context")
        .then(function(response) {
          return response.json();
        })
        .then(function(data) {
          let descendants = data['descendants'];
          if(
            descendants &&
            Array.isArray(descendants) &&
            descendants.length > 0
          ) {
            commentsWrapper.innerHTML = "";
            descendants.unshift(op);

            data['descendants'].forEach(function(status) {
              if( status.account.display_name.length > 0 ) {
                status.account.display_name = escapeHtml(status.account.display_name);
                status.account.display_name = emojify(status.account.display_name, status.account.emojis);
              } else {
                status.account.display_name = status.account.username;
              };

              let instance = "";
              let verified = false;
              if( status.account.acct.includes("@") ) {
                instance = status.account.acct.split("@")[1];
              } else {
                instance = "hachyderm.io";
                verified = true;
              }

              status.content = emojify(status.content, status.emojis);

              let avatarSource = document.createElement("source");
              avatarSource.setAttribute("srcset", escapeHtml(status.account.avatar));
              avatarSource.setAttribute("media", "(prefers-reduced-motion: no-preference)");

              let avatarImg = document.createElement("img");
              avatarImg.className = "avatar";
              avatarImg.setAttribute("src", escapeHtml(status.account.avatar_static));
              avatarImg.setAttribute("alt", `Avatar for ${ status.account.display_name }`);

              let avatarPicture = document.createElement("picture");
              avatarPicture.appendChild(avatarSource);
              avatarPicture.appendChild(avatarImg);

              let avatarLink = document.createElement("a");
              avatarLink.className = "avatar-link";
              avatarLink.setAttribute("href", status.account.url);
              avatarLink.setAttribute("rel", "external nofollow");
              avatarLink.setAttribute("title", `View profile at @${ status.account.username }@${ instance }`);
              avatarLink.appendChild(avatarPicture);

              let instanceBadge = document.createElement("a");
              instanceBadge.className = "instance";
              instanceBadge.setAttribute("href", status.account.url);
              instanceBadge.setAttribute("title", `@${ status.account.username }@${ instance }`);
              instanceBadge.setAttribute("rel", "external nofollow");
              instanceBadge.textContent = instance;

              let display = document.createElement("span");
              display.className = "display";
              display.setAttribute("itemprop", "author");
              display.setAttribute("itemtype", "http://schema.org/Person");
              display.innerHTML = status.account.display_name;

              let header = document.createElement("header");
              header.className = "author";
              header.appendChild(display);
              header.appendChild(instanceBadge);

              let permalink = document.createElement("a");
              permalink.setAttribute("href", status.url);
              permalink.setAttribute("itemprop", "url");
              permalink.setAttribute("title", `View comment at ${ instance }`);
              permalink.setAttribute("rel", "external nofollow");
              permalink.textContent = new Date( status.created_at ).toLocaleString('en-US', {
                dateStyle: "long",
                timeStyle: "short",
              });

              let timestamp = document.createElement("time");
              timestamp.setAttribute("datetime", status.created_at);
              timestamp.appendChild(permalink);

              let main = document.createElement("main");
              main.setAttribute("itemprop", "text");
              main.innerHTML = status.content;

              let interactions = document.createElement("footer");
              if(status.favourites_count > 0) {
                let faves = document.createElement("a");
                faves.className = "faves";
                /* FIXME: This is a hack and probably won't work w/non-Mastodon instances */
                faves.setAttribute("href", `${ status.url }/favourites`);
                faves.setAttribute("title", `Favorites from ${ instance }`);
                faves.textContent = status.favourites_count;

                interactions.appendChild(faves);
              }

              let comment = document.createElement("article");
              comment.id = `comment-${ status.id }`;
              comment.className = "comment";
              comment.setAttribute("itemprop", "comment");
              comment.setAttribute("itemtype", "http://schema.org/Comment");
              comment.appendChild(avatarLink);
              comment.appendChild(header);
              comment.appendChild(timestamp);
              comment.appendChild(main);
              comment.appendChild(interactions);

              if(verified === true) {
                comment.classList.add("verified");
              }

              commentsWrapper.innerHTML += DOMPurify.sanitize(comment.outerHTML);
            });
          }
        });
      });
    }

    function emojify(input, emojis) {
      let output = input;

      emojis.forEach(emoji => {
        let picture = document.createElement("picture");

        let source = document.createElement("source");
        source.setAttribute("srcset", escapeHtml(emoji.url));
        source.setAttribute("media", "(prefers-reduced-motion: no-preference)");

        let img = document.createElement("img");
        img.className = "emoji";
        img.setAttribute("src", escapeHtml(emoji.static_url));
        img.setAttribute("alt", `:${ emoji.shortcode }:`);
        img.setAttribute("title", `:${ emoji.shortcode }:`);
        img.setAttribute("width", "20");
        img.setAttribute("height", "20");

        picture.appendChild(source);
        picture.appendChild(img);

        output = output.replace(`:${ emoji.shortcode }:`, picture.outerHTML);
      });

      return output;
    }

    function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/'/g, "&apos;")
        .replace(/"/g, "&quot;")
      ;
    }
  </script>
</section><hr />
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <ul class="contact-list">
          

             <a href="/feed.xml" title="RSS">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fas fa-circle fa-stack-2x fa-gradient"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">RSS</span>
            </a>
            <a href="mailto:christopher@christopherhimes.com" title="Email me">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fas fa-circle fa-stack-2x fa-gradient"></i>
                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">Email me</span>
           </a>
            <a href="https://github.com/christopherhimes" title="GitHub">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fas fa-circle fa-stack-2x fa-gradient"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">GitHub</span>
           </a>
            <a rel="me" href="https://hachyderm.io/@eeentropyyy">
              <span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fas fa-circle fa-stack-2x fa-gradient"></i>
                <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i>
              </span>
              <span class="sr-only">Mastodon</span>
            </a>
      </div>
      <div class="footer-col">
        <p>Christopher Himes is a Software Developer living in Metro Detroit.
</p>
      </div>
    </div>


  </div>

</footer>
</body>

</html>
